---
title: "构建自己的博客系统"
publishDate: 2022-02-03
summary: "2014 年，我注册了这个域名用来自建博客发表文章，相继用过了 WordPress，Hexo，Hugo 等等博客系统。去年突发奇想，想要 DIY 一个。迭代更新了半年时间，收到了不少朋友们的好评。本文主要介绍一下这个博客系统开发过程中总结的经验。"
image: images/blog-diy/title.png
series: 博客搭建手记
---

2014 年，我注册了这个域名用来自建博客发表文章，相继用过了 WordPress，Hexo，Hugo 等等博客系统。去年突发奇想，想要 DIY 一个。迭代更新了半年时间，收到了不少朋友们的好评。

我的博客系统已经开源到 Github，点个 Star 支持一下吧~

<GithubRepo repo="whexy/blog-1999" />

## 博客系统

本文原名“个人博客搭建指北”，于 2022 年 1 月发表在本站。但文章涉及到的内容超出了普遍认知的“个人博客”，反而是花了更多笔墨讨论整个博客系统中设计与运营方面的经验。所以在原文的基础上进行了删改，形成了《构建自己的博客系统》一文。

简单来说，“博客系统”负责将博文内容转换成可供阅览的博客网页。以最著名的开源博客系统 Hexo 为例：站长只需要提供文章的 Markdown 文稿，即可用 Node.js 脚本生成一个静态博客网站。他也可以使用网上公开的博客主题来调整网站的外观。这些博客系统非常方便，很适合快速搭建博客网站。配合近年来蓬勃发展的静态网页托管服务（如 GitHub Pages，Netlify，腾讯云 COS 等），可以迅速把博客部署到互联网上。搭建及运营维护的成本非常低。

### Why?

那么为什么还要构建自己的博客系统呢？开源的方案不香吗？

不香，原因可以用一个词概括：“**天花板**”：只是发表博客，使用开源系统就能很好地完成任务。但当你尝试完成“进阶操作”时，一定会撞上一个可以感知的天花板，举步维艰。

举个例子，我偶尔写一些系列文章，标题类似于“电锯杀人魔（四）”。现在想要给网站加上系列跳转的功能，可以在正文前后直接跳转到同一系列的其他博客文章。

<Dialog>注意是直接跳转，而不是利用标签（tags）进行索引。</Dialog>

如果使用 Hexo 作为博客系统，就不可避免地需要写插件；写插件就不可避免地需要读 Hexo 那一塌糊涂的开发者文档；读懂文档就不可避免地需要了解 Hexo 的底层知识……也许你最终写出了插件，但是 it doesn't work，因为 Hexo 本身有 Bug。那这个时候你还需要去开源社区提 Issue，等修复；如果你足够顽强，也可以提交 PR，和 CI 搏斗，和 Maintainer argue……想象给系统“做手术”：找到合适的位置，切开它的代码，取出旧的器官（部件），填充新的，防止系统由于新部件的引入而崩坏。全程都是在不适感的包围中完成。

而在自己构建的博客系统里，你可以用最舒适的方式完成进阶操作——系统从上到下都是你的，想怎么改就怎么改，想实现什么就实现什么。一个词概括：“自由”。

### Seriously, why?

以上都是技术角度的观点。抛开技术，为什么我要构建自己的博客系统？

由于人脑的局限性，我们无法直接用思想对话。思想观点经过统筹、提炼、加工形成文字，被书写、阐述、表达。这个过程称为“写作与交流”。

由于技术的局限性，我的文字只能通过这块有限大小的屏幕送达到你的眼前。文字再经过统筹、提炼、加工形成博客网页，被观察、触摸、交互。这个过程在我心中和写作交流同等重要，一样属于意识的传递、思想的对话。字体、图表、排印、边界，和我的文本一起同时抵达。这个过程就由我的博客系统完成。

曾经我不关心形式，鄙视用形式达成目的。但是经过实践我逐渐明白：低级形式是纯粹的目的。中级形式是手段而不是目的。高级形式既是手段又是目的。形式不仅是传递思想的手段——形式即思想。

---

相信原因已经足够，我们开始《搭建自己的博客系统》吧。

文章分为四个部分。

1. **设计**：文章排版、组件定义、页面设计，构思一个兼具观赏性和实用性的的阅读页面。
2. **创作**：写什么文章、该怎么写，如何制作有风格的配图，怎样引导读者互动。
3. **技术**：在 DIY 博客系统过程中尝试过的各类框架和开源项目。
4. **分发**：搜索引擎 SEO 优化、CDN 选型、RSS 订阅和友情链接。

## 设计

自建博客系统最大的好处就是：博主可以完全掌握站点的设计，而不是在主题商店里面矮个子选将军。你的设计甚至可以细化到一个组件在鼠标悬浮时的动画效果。举一个例子：下面的卡片是我的博客系统里一个叫做 AnimatedFancyCard 的组件，使用 react-spring 动画框架制作。鼠标悬浮并缓慢移动时会有 3D 特效。

<AnimatedFancyCard>
<Callout icon="🖱" title="缓慢移动鼠标到四个顶点处">
Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

滚滚长江东逝水，浪花淘尽英雄，是非成败转头空。青山依旧在，几度夕阳红。白发渔樵江渚上，惯看秋月春风，一壶浊酒喜相逢。古今多少事，都付笑谈中。

</Callout>
</AnimatedFancyCard>

是不是很酷？当然，我们不会讨论怎么制作网页动画。借用导师的一句话：“我只负责提供 high-level 的想法”。在博客系统设计的过程中，我特别留意下面提到的三个要点。

### 文章排版

排印（Typography）是一种职业，我们作为业余人士当然排不出媲美书籍的精美程度。不过，就像编程语言需要遵循“最佳实践”（Best Practice）一样，只要遵循前人总结的经验，就不至于设计出太过离谱的版面。这里我推荐 GitHub 上过万 Star 的《中文文案排版指北》。排版指引文档包含中英文混排空格、标点符号全半角、英文名词大小写等等规则。

<GithubRepo repo="sparanoid/chinese-copywriting-guidelines" />

### 组件定义

相比于只能使用标准 Markdown 语法的博客生成器，自建博客系统中可以方便地添加自己喜欢的样式。例如我经常使用的对话气泡。

<Dialog>他说的是我们吗？</Dialog>
<DialogBack>我觉得是。</DialogBack>

以及模仿 Notion （一款笔记应用）里面 `/callout` 风格的卡片，很适合用作 warning 或者 tips 。

<Callout icon="💡" title="加入组件">
  在博客文章中加入组件有两种方式。一种是我现在使用的
  [MDX](https://mdxjs.com/)，一种 Markdown 的拓展格式，可以在其中添加
  React Components。另一种是我之前使用的小 trick：修改 Markdown
  渲染器，加入一些自定义语法，使之渲染出特殊的 HTML
  标签，再利用标签选择器在 CSS 里定义对应的卡片样式。
</Callout>

### 页面设计

首先为本人的工科直男审美感到抱歉。这一部分我没有发言权，以下都是笑话，大家笑笑就过去了。

**主题色**。因为缺乏美术功底，我不能驾驭色彩复杂的页面。这时候选用一个主题颜色作为博客的主色调是最讨巧的设计方式。我的博客主页用了<b className="text-red-500">红色（#dc252b）</b>作为主色调，并且在文章的组件里经常使用这两个颜色。

**移动端优先**。现在使用小屏幕设备（视口宽度小于 640px）阅读的人越来越多。根据 Google Analysis 的统计数据，我的博客有 70% 的流量来自移动端。后面会提到，可以用 CSS 的 media 查询方便地进行移动端适配。

**深色模式**。无论是 Windows 还是 Mac，Android 还是 iOS，都会在晚上切换到深色模式。在黑色的大环境下里浏览白底黑字内容对眼睛是一种摧残，所以博客需要单独适配深色模式。深色模式不是把背景换成黑色、文本调成白色这么简单：为了不影响文本的辨别，文本与背景的颜色对比度至少需要达到 4.5:1。这里我推荐 Google Material Design 团队的深色模式设计指南 [Dark theme - Material Design](https://material.io/design/color/dark-theme.html)，里面有更加详细的设计规则。

## 创作

博客的核心在于创作。克隆一个 Hexo，配置 NeXT 主题，然后在文章里粘贴上一堆根本跑不了的代码，最后把博客链接往简历里面一放——这和在 CSDN 里塞垃圾有什么区别？

### 写什么

写博客不仅是一种自娱自乐，也是讨论技术、结交朋友的方式。我有一个巨大的选题库，里面都是我想探索的新技术、和朋友讨论的怪点子、还有开坑后不想继续更的系列文章。

不过我的内容还是太散太零碎了，很多地方不够深入。这里介绍两个我最喜欢的中文博客：

- [面向信仰编程 (draveness.me)](https://draveness.me/)
- [编程技术系列文章 · 构建我的被动收入 (bmpi.dev)](https://www.bmpi.dev/dev/)

### 配图

我前面说“形式既是手段又是目的”。配图是其中最重要的一环。我读系统方向的论文，首先会看架构图；计算机科学的动物园 · 专业课课本 · O’Reilly 出版的动物书里，一定会有插图辅以讲解；越艰深的技术文章越需要图片帮助理解。

不过，随意的配图会增加阅读难度，而且会引起读者的反感。我的文章里配图尽量遵循同一个风格。例如在[《Faster Creating of Large Processes on Linux》](/posts/fork)文章里使用的“内存栈”的配图：

![内存栈的配图](images/FwRw4r.jpg)

在另一篇文章[《细究内存管理（一）》](/posts/malloc1)中，同一个风格（或者说色系，配色方案）的配图：

![堆操作的配图](images/malloc/heap_memory.png)

配图是用 Sketch 画的，导出成固定宽度的 PNG 位图。最近想把图片换成 SVG 矢量图，这样可以通过 CSS 进行色彩取反，以获得在深色模式下一致的阅读体验。

更多关于博客配图的讨论，这里推荐[技术文章配图指南](https://draveness.me/sketch-and-sketch/)一文。

### 互动

因为作者（我）水平有限，读者往往会对文章的内容产生疑问。这时候需要博客有一个评论系统。传统评论需要强大的后端数据库支持注册、登录、富文本、广告封禁等功能，增加了博客系统开发的难度。

好在现在可以使用通用评论平台。这是一种嵌入博客的 frame，调用第三方平台（例如 GitHub issues）完成评论。其中比较有名的是 discus 和 utterances，以及我正在使用的 [giscus](https://giscus.app/)。

另外，一些小功能也可以基于 Serverless 自行开发。例如我给博客增加的点赞功能，详见[《FaaS：为静态博客添加点赞功能》](/posts/faas)。

## 技术

如果说后端技术是“日新月异”，那么前端技术可谓是“瞬息万变”。这里简单介绍一下我在构建博客系统的过程中使用过的技术框架和开源项目。

### React 生态

目前博客系统是全面基于 React 制作的。React 是常年占据市场份额第一的前端框架。它将 HTML 嵌入 JS 中，利用函数计算动态返回 HTML。这种网站称为「单页面应用」。看起来博客是多个页面组成，实际上只是单个页面，里面的组件被不断的替换更新而已。在博客网页间跳转时，重复的内容（如顶栏、底栏、LOGO 等）不会重新加载。

不过， React 会在浏览器里执行 JS 生成页面，这种「客户端渲染」的模式会导致部分低性能设备卡顿，甚至会出现页面渲染错位或空白。这时候需要用「服务端渲染」的框架来弥补 React 的缺点。

#### Next.js

Next.js 可以说是官方钦定的服务端渲染框架了，最近他们开了 [Next.js Conf 2021](https://nextjs.org/conf)，就是这个大会拉我入坑。听名字也可以看出，这个框架代表了未来前端技术发展的方向。

Next.js 的思路是，先在服务端渲染好一个 HTML 传递给用户，然后再运行 JS，把“过时”或“粗糙”的内容替换掉。这个过程被形象地称为「注水」——向一个干瘪的网页慢慢填充生动的内容。我的博客也处处运用了这种技术：

- 网页里的图片会先显示一个模糊的占位图，等到进入用户可视区域后再加载。
- 动态字体加载，没用到的字会从字体文件中剔除。
- GitHub 小组件会在渲染时缓存 star 数，用户打开页面时会更新 star 数。由于 GitHub 的 API 在国内直接访问很慢，所以读者可能看到的就是缓存的 star 数。

#### MDX 与小组件

使用了 React 的好处是可以使用 MDX 了。直接在 Markdown 里嵌入 React 组件，不再需要魔改 Markdown 渲染器。例如我制作了 Dialog 的组件。如果需要在文章里插入对话气泡，可以直接用`<Dialog>content</Dialog>`。

还有很多写着玩的小组件。例如我发现博客中经常分享 GitHub 仓库的链接，何不在博客里直接展示 GitHub 仓库的描述、作者、star 数？我还写了一个叫做 NowPlaying 的小组件，用于展示当前我在用 Spotify 放什么音乐（放在了页面底部）。当然，这些都是找乐子玩玩的，cooooool。

### Tailwind CSS

我可太喜欢 [Tailwind CSS](https://tailwindcss.com/) 了！去年年初参与了一个在线背单词的开源项目（叫做 QWERTY），项目组的成员向我安利了这个 CSS 框架。点进项目地址里看看 Tailwind CSS 的 Demo 吧，你一定会喜欢的。

如果要实现一个 Flex 动态布局将方框居中。

<div>
  <div className="not-prose flex items-center justify-center border">
    <div className="h-[100px] w-[100px] bg-red-100" />
  </div>
</div>

使用传统 HTML+CSS，你需要写很多样式：

```html:wo/Tailwind.html
<style type="text/css">
  .box {
    display: flex;
    align-items: center;
    justify-content: center;
    border-width: 1px;
  }

  .box div {
    width: 100px;
    height: 100px;
    background-color: rgb(220 252 231);
  }
</style>

<div class="box">
  <div></div>
</div>
```

用 Tailwind CSS，连 CSS 文件都不需要，只用写一个 HTML 页面：

```html:w/Tailwind.html
<div class="flex items-center justify-center border">
  <div class="h-[100px] w-[100px] bg-red-100"></div>
</div>
```

可以说 Tailwind CSS 就是这个博客系统诞生的原因。没有 CSS 的知识也能轻松排版。它能够用极短的 className 处理屏幕尺寸、深色模式、鼠标悬浮状态等等复杂排版场景。而这些场景用 CSS 写往往要数十行代码。

### 一些最终没有使用的技术框架

#### 被淘汰的 11ty + Nunjucks

最开始，我使用了 [11ty](https://www.11ty.dev/) 作为静态网页生成器。它基于 [Mozilla Nunjucks](https://mozilla.github.io/nunjucks/) 语法实现模板网页渲染。你需要写好一个 HTML 模板，在里面留空（告诉 11ty “这里填入标题”，“这里填入文章内容”）。11ty 会按照你指定的规则填空，生成最后的网页。这类静态网页生成器最适合用来写博客网站。

Notion 风格的 Callout 也是在博客系统的 11ty 时期引入的。我魔改了 Markdown 渲染器 [markdown-it](https://github.com/markdown-it/markdown-it)，给 Markdown 增加了一个语法，让它遇到三个连续的等于号，就输出 `<div class="callout">...</div>`。接着给 `.callout` 类定义样式即可。

但是生成器也有缺点：

- 可以抽象组件，但只能抽一点点
- 无法控制渲染顺序，复杂逻辑实现困难

在我加入了更多页面之后，复用代码成了大问题。虽然部分解决了组件抽象的问题，但编程复杂度、代码混乱程度让我难以继续维护博客网站。所以最终我不再使用 11ty。

#### Headless CMS

Headless 指“无头的”，一般来说就是“无界面的”“无系统的”。Headless CMS 是目前国外比较火的博客内容管理方案，通过 GraphQL（图数据库）获取数据。本质上是博客后端服务器。这里我推荐这篇文章 [Headless CMS explained in 1 minute](https://www.contentful.com/r/knowledgebase/what-is-headless-cms/) 了解 Headless CMS 的概念。

从前我们把文章存储在本地的 Markdown 文件里，然后让生成器生成静态网站。每次发新博客都需要 rebuild 一遍网站，再上传到服务器。而 Next.js 使用服务端渲染，在 CMS 的更新后（例如发布新文章，或修改旧文章）可以触发 Next.js 的重渲染。重新渲染的结果立刻显示在读者的网页上。

不过我感觉使用 Headless CMS 的一般是多人共同经营的大型博客网站，例如一个软件团队，或者一个实验室。大家只用在 CMS 后台上传就能正常发布文章，而不用去 rebuild 整个系统。作为个人博客，Headless CMS 属于杀鸡用牛刀。所以我试了一阵子就放弃了。

### 技术总结

目前博客使用的技术栈是：

- React 用于封装组件、绘制页面
- Next.js 用于服务端渲染，优化浏览体验
- MDX 用于拓展 Markdown 的能力
- Tailwind CSS 用于样式设计
- 自制 Serverless 用于实现点赞/阅读数功能

## 分发

如何评价一个博客？文章质量、读者数量、精美程度？作为一个博主，你需要对博客的总体情况有大致的了解。

### SEO 收录

SEO 收录表征博客文章在搜索引擎的收录情况。实话说我现在的 SEO 收录情况也不乐观。提高 SEO 的最好方法是让别的网站多多收录本网站的链接（例如交换友链、发布广告等等）。提升页面的 Metric 也有助于提升 SEO。

### Metric

来自谷歌团队的 [Lighthouse](https://developers.google.com/web/tools/lighthouse) 是一个测量网站表现的工具。使用 Chromium 内核的浏览器都在开发者工具里附带了这个功能。它测量的指标包括 Performance, Accessibility, Best Practices, SEO 等。你可以获得 First Contentful Paint, Max Potential First Input Delay 等等很细致的数据，用于优化网站的体验。它也会提示你的页面对于无障碍访问的优化情况，方便你制作一个有人情味的网站。

### CDN

在国内注册域名、购买服务器、部署网站，一个逃不过的事就是繁琐的备案。如果使用海外的服务器，国内的访问又会很慢。所以我的方案是使用国外的服务器（Vercel，Next.js 的母公司），并用全球 CDN 加速（Microsoft Azure）。这里我推荐这篇文章：[个人博客 CDN 选型和进阶玩法指北 | NekoDaemon's Blog](https://nekodaemon.com/2021/08/12/个人博客CDN选型和进阶玩法指北/)，文章里比对了各种个人博客 CDN 方案的优劣。

### 订阅

各种算法推荐看起来不错，但是久而久之会陷入“信息茧房”，得到一个只为了讨你开心的信息流。如果遇到了你喜欢的博客，应该用 RSS 订阅它的更新。本博客提供两种 RSS 非全文源。[RSS2.0](https://www.whexy.com/feed/feed.xml) 和 [JSON](https://www.whexy.com/feed/feed.json) 版本。

<Dialog>为什么不是全文源？</Dialog>
<DialogBack>
  RSS 分发不支持 CSS，如果是全文源，我们的自定义组件就无法正常显示了。
</DialogBack>

关于 RSS 阅读器，我推荐 iOS/macOS 平台的 Reeder。你也可以自架一个 RSS 订阅中心用于同步各设备之间的阅读数据，例如开源的 [FreshRSS](https://freshrss.org/)。

## 总结

这篇《构建自己的博客系统》就到这里结束了。我从四个角度出发介绍了构建自己博客系统时的构思和工作。这篇文章同时鼓励你自己搭建一套博客系统，因为这很有意思。我的感觉是：“码农”升级成了“互联网工匠”。这个过程伴随着一种成就感、自豪感。就和阅读、看电影、玩游戏一样，配置和优化博客系统成了我业余时间的乐趣之一。

如果你喜欢这篇博客，或想第一时间获得通知，可以通过 RSS 订阅更新。也欢迎关注我的 GitHub 和推特账号。我平时是主要分享关于计算机系统安全的内容。如果你对这篇文章有任何疑问或建议，请在下方留言。再会~
