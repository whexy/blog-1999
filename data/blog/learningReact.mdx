---
title: "React å­¦ä¹ ç¬”è®°"
publishDate: 2020-10-21
summary: "React å‡ ä¹åˆ©ç”¨äº†åŸç”Ÿ JavaScript çš„æ‰€æœ‰ç‰¹è´¨ã€‚åœ¨å¯¹ JavaScript æ¯”è¾ƒç†Ÿç»ƒçš„æƒ…å†µä¸‹ï¼ŒReact ä¸ä¼šç»™ä½ å¸¦æ¥æ›´å¤šçš„æƒŠå–œã€‚ä¸è¿‡ï¼Œç›¸è¾ƒäº Vueï¼Œå†™ React ä¹Ÿç»™äººä¸€ç§è¸å®çš„æ„Ÿè§‰ã€‚"
---

React å‡ ä¹åˆ©ç”¨äº†åŸç”Ÿ JavaScript çš„æ‰€æœ‰ç‰¹è´¨ã€‚åœ¨å¯¹ JavaScript æ¯”è¾ƒç†Ÿç»ƒçš„æƒ…å†µä¸‹ï¼ŒReact ä¸ä¼šç»™ä½ å¸¦æ¥æ›´å¤šçš„æƒŠå–œã€‚ä¸è¿‡ï¼Œç›¸è¾ƒäº Vueï¼Œå†™ React ä¹Ÿç»™äººä¸€ç§è¸å®çš„æ„Ÿè§‰ã€‚

é˜…è¯» [React æ–‡æ¡£](https://zh-hans.reactjs.org/docs/getting-started.html) åçš„ç¬”è®°

## JSX

```javascript
const element = <h1>Hello, world!</h1>;
```

JSX æ˜¯ ä¸€å¥— Javascript æ‹“å±•ã€‚å®ƒå°† html å…ƒç´ åµŒå…¥åˆ° JavaScript ä»£ç é‡Œã€‚

## å…ƒç´ 

```javascript
const element = <h1>Hello, world</h1>;
ReactDOM.render(element, document.getElementById("root"));
```

React DOM å…ƒç´ æ¡†æ¶ç»´æŠ¤çš„ä¸€ä¸ªé™æ€ä¸å¯å˜æœ€å°å•ä½ã€‚å› æ­¤ React å£°ç§°å®ƒçš„å¼€é”€éå¸¸å°ã€‚
ç”±äºæ˜¯ä¸å¯å˜å•ä½ï¼Œæ¯æ¬¡é¡µé¢çš„æ›´æ–°å®é™…ä¸Šæ˜¯æ–°å…ƒç´ å¯¹æ—§å…ƒç´ çš„è¦†ç›–ã€‚

## ç»„ä»¶

React å°†å…ƒç´ å’Œåº•å±‚ç»„ä»¶ç»„åˆï¼ŒæŠ½è±¡æˆæ›´é«˜ç»´åº¦çš„å¯å¤ç”¨ç»„ä»¶ã€‚

ç»„ä»¶çš„å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼šå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ï¼ˆES6 Laterï¼‰

```javascript
//å‡½æ•°
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
//ç±»
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

ç”¨æˆ·å®šä¹‰çš„ç»„ä»¶è¦æ±‚é¦–å­—æ¯å¤§å†™ã€‚å®šä¹‰å®Œæˆåï¼Œå¯ä»¥ç›´æ¥åœ¨ JSX é‡Œè°ƒç”¨ã€‚

```javascript
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}

const element = <Welcome name="Sara" />;
ReactDOM.render(element, document.getElementById("root"));
```

React åœ¨æ–‡æ¡£é‡Œä¸¾äº†ä¸€ä¾‹ï¼Œç”¨äºå±•ç¤ºå°†ç»„ä»¶æå–å¤šä¸ªå°ç»„ä»¶ç»™ç¨‹åºç¼–å†™å¸¦æ¥çš„å¥½å¤„ã€‚è¿™å…¶ä¸­ï¼ŒReact å»ºè®®ä»ç»„ä»¶è‡ªèº«çš„è§’åº¦å‘½å propsï¼Œè€Œä¸æ˜¯ä¾èµ–äºè°ƒç”¨ç»„ä»¶çš„ä¸Šä¸‹æ–‡å‘½åã€‚

æ­¤å¤–ï¼Œç»„ä»¶ä¹Ÿå¿…é¡»ä¿è¯è‡ªå·±ä¸å¯¹ä¼ å…¥çš„ props åšä»»ä½•ä¿®æ”¹ã€‚

## çŠ¶æ€

å‡½æ•°ç»„ä»¶æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„ç»„ä»¶ï¼Œä¸æ”¯æŒå…¶å®ƒç‰¹æ€§ã€‚ä½¿ç”¨ç±»ç»„ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ç»´æŠ¤ç±»çš„ã€Œæˆå‘˜å˜é‡ã€ï¼Œè¾¾åˆ°ç»„ä»¶å­˜å‚¨çŠ¶æ€çš„ç›®çš„ã€‚

ä¸‹é¢çš„ä¾‹å­åœ¨ç»„ä»¶è£…è½½çš„æ—¶å€™ç»´æŠ¤äº†è‡ªå·±çš„ stateã€‚state æ˜¯ä¸€ä¸ª JS å¯¹è±¡ã€‚

```javascript
class Clock extends React.Component {
  constructor(props) {
    super(props);
    this.state = { date: new Date() };
  }

  render() {
    return (
      <div>
        <h1>Hello, world!</h1>
        <h2>It is {this.state.date.toLocaleTimeString()}.</h2>
      </div>
    );
  }
}
```

ç„¶è€Œï¼Œå¯¹äº`this.state`çš„ç›´æ¥ä¿®æ”¹æ˜¯ä¸ä¼šè¢« React **æ•è·**ä»è€Œæ›´æ–°åˆ°é¡µé¢ä¸Šçš„ã€‚~~ä¹Ÿè®¸æ˜¯ä¼—å¤šå¯¹ React è´Ÿé¢è¯„ä»·çš„åŸå› ï¼Ÿ~~

éœ€è¦è°ƒç”¨ `this.setState(object)` å‡½æ•°æ¥æ›´æ–°çŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°æœ‰è‹¥å¹²ç‰¹ç‚¹ï¼š

1.  æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤ä¸å¯ä»¥ä¾èµ– state çš„å€¼è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚
2.  `this.setState()` å¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ¬¡çŠ¶æ€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„å‚æ•°ã€‚**ä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°å¯ä»¥è§£å†³å¼‚æ­¥æ›´æ–°å‡ºé”™çš„é—®é¢˜ã€‚**

```js
this.setState((state, props) => ({
  counter: state.counter + props.increment,
}));
```

3.  State çš„æ›´æ–°æ˜¯æµ…æ›´æ–°ã€‚`this.setState(small_obj)` ä¸ä¼šè¦†ç›–æ‰`small_obj`ä»¥å¤–çš„å…¶ä»–å±æ€§ã€‚

### å‘ä¸‹æµåŠ¨

å„ç±»ç»˜åˆ¶ GUI çš„è¯­è¨€éƒ½ä¸æ–­å¼ºè°ƒä¸€ä¸ªæ¦‚å¿µ â€”â€” **ä¸€è‡´æ€§**ã€‚ å‰ç«¯ç»å¸¸åœ¨ä¸åŒç»„ä»¶ä¸­å¯¹åŒä¸€æ•°æ®æ¥æºåšæ˜¾ç¤ºå’Œä¿®æ”¹ã€‚ä¾‹å¦‚ç”¨æˆ·åœ¨è®¾ç½®é¡µé¢ä¸­æ›´æ”¹ç”¨æˆ·åä¹‹åï¼Œæ‰€æœ‰æ˜¾ç¤ºç”¨æˆ·åçš„åœ°æ–¹éœ€è¦åŒæ­¥æ›´æ–°ã€‚å¦‚æœè®©æ¯ä¸ªç»„ä»¶è‡ªå·±ç»´æŠ¤æ›´æ–°æ“ä½œï¼Œå°±è¿›å…¥äº† bug å¤šå‘åœ°ã€‚

ä¾‹å¦‚ï¼ŒiOS å‰ç«¯æ¡†æ¶ SwiftUI å¤„å¤„å¼ºè°ƒã€ŒSingle Source of Truthã€çš„æ¦‚å¿µã€‚ React è™½ç„¶æ²¡æœ‰ä¸¥è°¨çš„çŠ¶æ€ç­›æŸ¥çš„æ¦‚å¿µï¼Œä½†æ˜¯å¯ä»¥å°† `state` çš„å†…å®¹ä½œä¸ºä¸‹ä¸€ä¸ª `props` ä¼ å…¥å­ç»„ä»¶ã€‚React å½¢è±¡åœ°ç§°è¿™ç§å†™æ³•ä¸ºã€Œå‘ä¸‹æµåŠ¨ã€ã€‚

ç„¶è€Œï¼ŒReact ç¦æ­¢ä»»ä½•å¯¹äºä¼ å…¥å±æ€§çš„ä¿®æ”¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨å­ç»„ä»¶é‡Œä¿®æ”¹å•ä¸€æ•°æ®æºï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨**å”¯ä¸€ä¿®æ”¹å‡½æ•°**ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æŒæœ‰ state çš„ç¥–å…ˆå®ç°çš„ä¿®æ”¹å‡½æ•°ï¼ˆ[ã€ŠReact å“²å­¦ã€‹](https://zh-hans.reactjs.org/docs/thinking-in-react.html)ä¸­ç§°åšã€Œåå‘æ•°æ®æµã€ï¼‰ã€‚~~è¿™ç‚¹éå¸¸éº»çƒ¦ã€‚~~ React å£°ç§°è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿è¿½è¸ª BUGï¼Œå› ä¸ºæ•°æ®çš„ä¿®æ”¹åªæœ‰ä¸€ä¸ªå…¥å£ã€‚

## ç”Ÿå‘½å‘¨æœŸ

åœ¨ç»„ä»¶è¢«æ”¾åˆ° DOM é‡Œå»ä¹‹åï¼Œä¼šè°ƒç”¨ `componentDidMount()` å‡½æ•°ã€‚ åœ¨å³å°†è¢«é”€æ¯çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ `componentWillUnmount()` å‡½æ•°ï¼Œé‡Šæ”¾æ‰€å ç”¨çš„èµ„æºã€‚

```js
class Clock extends React.Component {
  constructor(props) {
    super(props);
    this.state = { date: new Date() };
  }

  componentDidMount() {
    this.timerID = setInterval(() => this.tick(), 1000);
  }

  componentWillUnmount() {
    clearInterval(this.timerID);
  }

  tick() {
    this.setState({
      date: new Date(),
    });
  }

  render() {
    return (
      <div>
        <h1>Hello, world!</h1>
        <h2>It is {this.state.date.toLocaleTimeString()}.</h2>
      </div>
    );
  }
}
```

## äº‹ä»¶å¤„ç†

React å…ƒç´ äº‹ä»¶å’Œ DOM å…ƒç´ ç›¸ä¼¼ã€‚åœ¨è¯­æ³•ä¸Šï¼ŒReact ä½¿ç”¨å°é©¼å³°ï¼ˆonClickï¼‰ï¼Œå¹¶ä¸”ä¼ å…¥ä¸€ä¸ª JSX åŒ…è£…çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯ DOM ä¸­çš„å­—ç¬¦ä¸²ã€‚

```html
<!-- ä¼ ç»Ÿçš„ DOM å†™æ³• -->
<button onclick="handler()">A button</button>
```

```jsx
<!--  React å…ƒç´ å†™æ³•-->
<button onClick={handler}>
    A button
</button>
```

å¯ä»¥ç»™äº‹ä»¶å¤„ç†ç¨‹åºä¼ é€’å‚æ•°ã€‚

```jsx
<button onClick={e => this.handler(id, e)}>A button</button>
```

å…¶ä¸­`e`æ˜¯ React çš„äº‹ä»¶å¯¹è±¡ã€‚

<Callout icon="ğŸ’¡" title="TIPS">
  ç”±äº JavaScript è®¾è®¡çš„åŸå› ï¼ŒJSX çš„å›è°ƒå‡½æ•°é»˜è®¤ä¸ä¼šæºå¸¦ this
  å¼•ç”¨ï¼ˆå› ä¸º class çš„æ–¹æ³•ä¸ä¼šç»‘å®š thisï¼‰ã€‚
  æ‰€ä»¥åœ¨å®šä¹‰ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å°† this äº‹å…ˆç»‘ä¸Šå»ã€‚
</Callout>

å‚è€ƒé˜…è¯»ï¼š
[JavaScript ä¸­è‡³å…³é‡è¦çš„ Apply, Call å’Œ Bind](https://hijiangtao.github.io/2017/05/07/Full-Usage-of-Apply-Call-and-Bind-in-JavaScript/)

```js
class Toggle extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isToggleOn: true };

    // ä¸ºäº†åœ¨å›è°ƒä¸­ä½¿ç”¨ `this`ï¼Œè¿™ä¸ªç»‘å®šæ˜¯å¿…ä¸å¯å°‘çš„
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    this.setState(state => ({
      isToggleOn: !state.isToggleOn,
    }));
  }

  render() {
    return (
      <button onClick={this.handleClick}>
        {this.state.isToggleOn ? "ON" : "OFF"}
      </button>
    );
  }
}
```

æœ‰ä¸€ä¸ªå®éªŒæ€§è¯­æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°† `handleClick()` å‡½æ•°å†™æˆè¿™æ ·ï¼š

```js
handleCLick() = () => {
    console.log(this);
}
```

è¿™æ ·åšæ— éœ€åœ¨å¤–éƒ¨æ˜¾å¼ç»‘å®š thisï¼Œå°±å¯ä»¥åœ¨å‡½æ•°ä¸­è°ƒç”¨ thisã€‚
æˆ–è€…ä¹Ÿå¯ä»¥åˆ©ç”¨ JSX è¿™æ ·å†™ï¼š

```jsx
<button onClick={() => this.handleClick()}>A button</button>
```

## æ¡ä»¶æ¸²æŸ“

React é€šè¿‡å‡½æ•°ç»„ä»¶çš„è¿”å›å€¼ï¼Œæˆ–è€…ç±»ç»„ä»¶çš„`render()`å‡½æ•°æ¥æ¸²æŸ“å…ƒç´ ã€‚å› è€Œï¼Œåªè¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ¡ä»¶åˆ¤æ–­ï¼Œè¿”å›ä¸åŒçš„ JSXï¼Œå°±èƒ½å®ç°æ¡ä»¶æ¸²æŸ“ã€‚

```jsx
function Greeting(props) {
  const isLoggedIn = props.isLoggedIn;
  if (isLoggedIn) {
    return <UserGreeting />;
  }
  return <GuestGreeting />;
}

ReactDOM.render(
  // Try changing to isLoggedIn={true}:
  <Greeting isLoggedIn={false} />,
  document.getElementById("root"),
);
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨ `setState()` å‡½æ•°ï¼ŒReact éƒ½ä¼šè‡ªåŠ¨é‡æ–°æ‰§è¡Œ `rander()`ã€‚
æ‰€ä»¥ï¼Œå¯ä»¥åˆ›é€ å‡ºè¿™ç§æœ‰çŠ¶æ€çš„ç»„ä»¶ï¼š

```jsx
class LoginControl extends React.Component {
  constructor(props) {
    super(props);
    this.handleLoginClick = this.handleLoginClick.bind(this);
    this.handleLogoutClick = this.handleLogoutClick.bind(this);
    this.state = { isLoggedIn: false };
  }

  handleLoginClick() {
    this.setState({ isLoggedIn: true });
  }

  handleLogoutClick() {
    this.setState({ isLoggedIn: false });
  }

  render() {
    const isLoggedIn = this.state.isLoggedIn;
    let button;
    if (isLoggedIn) {
      button = <LogoutButton onClick={this.handleLogoutClick} />;
    } else {
      button = <LoginButton onClick={this.handleLoginClick} />;
    }

    return (
      <div>
        <Greeting isLoggedIn={isLoggedIn} />
        {button}
      </div>
    );
  }
}
```

æœ‰çŠ¶æ€ç»„ä»¶å¯ä»¥åœ¨`render()`å‡½æ•°é‡Œå¯ä»¥å…ˆæ ¹æ®çŠ¶æ€**è®¡ç®—**å‡ºéœ€è¦æ˜¾ç¤ºçš„å…ƒç´ ã€‚

è¿˜æœ‰ä¸€ä¸ªæ›´å¸…çš„å†™æ³•ï¼š

```jsx
<div>
  <h1>Hello!</h1>
  {unreadMessages.length > 0 && (
    <h2>You have {unreadMessages.length} unread messages.</h2>
  )}
</div>
```

åœ¨ JavaScript ä¸­ï¼Œ`true && express` ä¼šè¿”å› `express`ã€‚ç›¸åï¼Œ`false && express`ä¼šè¿”å› `false`ã€‚å¦‚æœè¿”å› `false`ï¼Œ React ä¼šå¿½ç•¥è¿™ç»„å…ƒç´ çš„æ¸²æŸ“ã€‚

å½“ç„¶ï¼Œä¸‰ç›®è¿ç®—ç¬¦ä¹Ÿå¯ä»¥ç”¨äºæ¡ä»¶æ¸²æŸ“ï¼š

```jsx
<div>
  {isLoggedIn ? (
    <LogoutButton onClick={this.handleLogoutClick} />
  ) : (
    <LoginButton onClick={this.handleLoginClick} />
  )}
</div>
```

## åˆ—è¡¨

ç±»ä¼¼äº Vue ä¸­çš„ `v-for`ï¼Œä½¿ç”¨ React ä¹Ÿå¯ä»¥åšåˆ°ã€Œå·æ‡’ã€çš„é‡å¤ç»„ä»¶æ¸²æŸ“ã€‚

```jsx
const numbers = [1, 2, 3, 4, 5];
const listItems = numbers.map(number => <li>{number}</li>);
ReactDOM.render(
  <ul>{listItems}</ul>,
  document.getElementById("root"),
);
```

ä¸Šæ®µä»£ç ä¸­ï¼Œ`listItems` æ˜¯ä¸€ä¸ª JSX çš„æ•°ç»„ã€‚React å¾ˆçµæ´»åœ°å°†å®ƒæ’å…¥é¡µé¢ä¸­ã€‚

æœ€å¥½ç»™åˆ—è¡¨å…ƒç´ ç»‘å®š keyã€‚è¿™æ ·ï¼ŒReact å¯ä»¥è¯†åˆ«å“ªäº›å…ƒç´ è¢«æ”¹å˜äº†ã€‚ç»‘å®š key çš„åœ°æ–¹åº”è¯¥åœ¨æ•°ç»„çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä¾‹å¦‚ï¼Œé€šå¸¸åœ¨ `map()` æ–¹æ³•ä¸­è®¾ç½® key å±æ€§ã€‚

```jsx
function ListItem(props) {
  return <li>{props.value}</li>;
}

function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map(number => (
    <ListItem key={number.toString()} value={number} />
  ));
  return <ul>{listItems}</ul>;
}

const numbers = [1, 2, 3, 4, 5];
ReactDOM.render(
  <NumberList numbers={numbers} />,
  document.getElementById("root"),
);
```

## è¡¨å•

å‰é¢æåˆ°ï¼ŒReact æ¨èä¸€ç§ã€Œå‘ä¸‹æµåŠ¨ã€çš„å†™æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä¿è¯ React ä¸­å¤„ç†çš„æ•°æ®æ¥è‡ª**åŒä¸€æ¥æº**ã€‚åœ¨ html ä¸­ï¼Œè¡¨å•å…ƒç´ é€šå¸¸ç”±æµè§ˆå™¨è‡ªå·±ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š

```html
<form>
  <label>
    <input type="text" name="name" />
  </label>
  <input type="submit" value="æäº¤" />
</form>
```

å…¶ä¸­è¾“å…¥æ¡†çš„å€¼æ˜¯ç”±æµè§ˆå™¨è‡ªå·±ç»´æŠ¤çš„ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®© React æ¥ç®¡çŠ¶æ€ï¼Œä»è€Œå®ç°**å”¯ä¸€æ•°æ®æº**çš„ç›®æ ‡ã€‚è¢« React æ¥ç®¡çš„è¡¨å•å…ƒç´ ç§°ä¸ºã€Œå—æ§ç»„ä»¶ã€ã€‚

```jsx
<form onSubmit={this.handleSubmit}>
  <label>
    åå­—:
    <input
      type="text"
      value={this.state.value}
      onChange={this.handleChange}
    />
  </label>
  <input type="submit" value="æäº¤" />
</form>
```

input, textarea, select ç­‰æ ‡ç­¾éƒ½å¯ä»¥è¢« React æ¥ç®¡ã€‚

## ç»„åˆ

React æ¨èä½¿ç”¨ JS çš„è¯­æ³•è¿›è¡Œç»„ä»¶é—´çš„ä»£ç é‡ç”¨ã€‚

### åŒ…å«å…³ç³»

ç»„ä»¶å¥—ç”¨çš„æ¨èå†™æ³•ï¼š

```jsx
function FancyBorder(props) {
  return (
    <div className={"FancyBorder FancyBorder-" + props.color}>
      {props.children}
    </div>
  );
}

function WelcomeDialog() {
  return (
    <FancyBorder color="blue">
      <h1 className="Dialog-title">Welcome</h1>
      <p className="Dialog-message">
        Thank you for visiting our spacecraft!
      </p>
    </FancyBorder>
  );
}
```

é€šè¿‡ `prop.children` å°†å­ç»„ä»¶ä¼ é€’åˆ°æ¸²æŸ“ç»“æœé‡Œå»ã€‚å¦‚æœæˆ‘ä»¬åœ¨ JSX é‡ŒæŒ‡å®šæ ‡ç­¾å‚æ•°çš„åå­—ï¼Œå¯ä»¥ä¸ç”¨ `children`ã€‚

### ç‰¹ä¾‹å…³ç³»

React ä¹Ÿå¯ä»¥è®¾è®¡ã€ŒæŠ½è±¡çˆ¶ç»„ä»¶ã€ã€‚å®ç°è¿™äº›ç»„ä»¶çš„ã€Œå­ç»„ä»¶ã€é€šè¿‡ä¼ å…¥ç‰¹å®šçš„å‚æ•°å®ç°ã€‚
