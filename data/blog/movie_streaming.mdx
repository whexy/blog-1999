---
title: "在寝室搭建一套电影播放系统"
publishDate: 2019-08-03
summary: "今天得空，介绍上个月的成果——一套宿舍电影放映系统的构建。寝室里有一台大屏显示器，晚上关了灯，连上蓝牙低音炮，大家围坐一起看一部电影，真是美滋滋的体验~ 床上有一个支架，用iPad连接AirPods，晚上拉上遮光帘一个人欣赏一部电影，也是美滋滋的体验…"
series: "折腾南科大校园网"
---

今天得空，介绍上个月的成果——一套宿舍电影放映系统的构建。寝室里有一台大屏显示器，晚上关了灯，连上蓝牙低音炮，大家围坐一起看一部电影，真是美滋滋的体验~ 床上有一个支架，用 iPad 连接 AirPods，晚上拉上遮光帘一个人欣赏一部电影，也是美滋滋的体验…

经过几天的调整，这套系统可以完成：

1. 以极低的功耗离线下载 BT/PT 电影资源（不用开电脑）。
2. 以极高的速率将电影传输到连接到系统的所有设备。

## 起源故事

事情得从很久以前金融圈的一件大事说起……也没有那么久。前一阵子，比特币暴跌，导致很多币圈挖矿大佬遭遇“矿难”。挖矿使用的高性能设备以极低的价格流入了二手市场。于是我趁机入手了一部高性能路由器，就是这款 new wifi 3。我收到的时候，已经刷好了 OpenWrt 固件，免去一大堆麻烦。~~（否则本篇文章的大部分篇幅就是怎样刷 OpenWrt 了）~~

![](/images/006tNc79gy1g4rjis7zu8j3064064t8k.jpg)

加上手头正好有一块固态硬盘，插上路由器，一个简易的局域网 NAS 就搭成了。

## STEP1 连接校园网并桥接

我们宿舍曾经~~由于年幼无知~~购买过南科大的宽带，事实上，这个电信公司提供的宽带并不比全校覆盖的无线网好多少（依然是高 ping 战士）。这次施工(?)，首先抛弃的就是妮科的宽带。

倘若用无线网卡桥接学校的 WiFi，会导致那一块网卡的相关属性全部损失一半。好在这款路由器自带双网卡，我用其中一块连接学校的 SUSTC-Wifi，另外一块产生一个无线局域网。

我宿舍还有几个智能设备（智能空调插座和智能台灯），所以新建了一个供它们专用的网络。

![](/images/006tNc79gy1g4rk8ga3u8j31sa0qowin.jpg)

Suggestion : Clinet 模式连接 WiFi，AP 模式放送信号。这样配置最简单。\*

## STEP2 磁盘挂载和映射

这步挺简单的，插上硬盘，设置一下挂载。

路由器装了 OpenWRT 的 WEB 管理器 LuCI~~（就中间的 u 是小写的，我一直以为是 lucl，没想到其实是 luci）~~，随便配置一下就行了。

![](/images/006tNc79gy1g4rk9pn97jj31qe0jan0v.jpg)

一块 500G 的硬盘还是能装不少东西的。

_Suggestion : 挂载的时候可以考虑顺便分个区，剩一块留作搭建 Time Machine 服务器。以后有空会写写这方面的东西。_

## STEP3 配置 SMB 服务

系统可以识别我们的磁盘了，这还不够，我们需要能让局域网里的其他设备都能访问磁盘。这时候，需要选择一个网络文件共享协议。

~~肯定不用 ftp，谁用谁傻 X🤬~~

好在 OpenWrt 固件里自带了 SMB 服务。SMB 也是 macOS 访达应用、Windows 网络中最容易拿来当文件夹直接用的服务。**还有，SMB 终于被 iOS 13 和 iPadOS 支持了！**

搭建 SMB 的时候需要考虑要不要加入用户名密码验证。如果需要，ssh 到路由器，用命令行自己手动添加用户组和用户密码。如果嫌麻烦，直接开游客访问好了~ 但是后续的安全性没有保障。

## STEP4 配置 Aria2/Transmission 服务

Aria2 和 Transmission 都是很好的网络下载服务。我推荐 Aria2 多一点，有很多拓展支持。但是最近我换成 Transmission 了，因为它有一种下载很快的错觉……

下图是 Transmission 的示意图。网页做得和古老的下载软件类似。

![我的图床挂了？](/images/006tNc79gy1g4rkb30mz4j31cw0u0472.jpg)

<Dialog>
  2021
  年重制博客的血泪教训：不要贪图便宜使用不稳定的图床。这样你珍藏多年的图就没了。
</Dialog>

记得稍微配置一下，别让下载服务把资源下载到本来就狭小拥挤的路由器闪存里去，这样会导致 ROM 剩余空间过小，被系统强制改成只读，你的路由器配置就改不了了（别问我怎么知道这个的）。

## STEP5 享受

已经建好了，是不是很简单呢？（不是）

使用 mac 看电影，可以在访达中 Command+K，输入 smb 服务地址。如下所示：

![](/images/006tNc79gy1g4rizoya7zj31at0u04qp.jpg)

使用 iPad 看电影，(iPadOS)可以在“文件”里选择“连接服务器”，连接到 smb 服务。

![](/images/006tNc79gy1g4rks0da0lj316o0d9dho.jpg)

对于没更新 iPadOS 的 iPad，我推荐~~使用一款叫做 VLC 的视频播放器，可以直接连接 SMB 服务。~~更新 iPadOS，真的很好用啊。

## [Optional] 更多可能性……

### 端口转发

刚才的配置结束后，你仍然只能在宿舍内享用这一套系统。而我……我喜欢到校园的其他地方看电影(??)，这时候你需要将 SMB 所用的端口转发出来。需要转发的端口可以谷歌搜索得到。如果你还想远程监控下载进度，还可以把 lan 的 80 端口转发出来。

在连接到 SUSTC Wifi 的时候，就可以通过学校的网络 CAS 登录记录查到宿舍当前 ip，用这个 ip 代替原来的 192.168.1.1 就行了。在撰写本文的时候，我就在图书馆截了本文的所有图片。这都归功于端口转发这一步骤。

### Frp 内网穿透

刚才的配置结束后，你仍然只能在学校内享用这一套系统。而……如果你想在校外呢？

🌚 首先，不推荐校外访问这套服务，对外网的传输，学校是有限速的。网速是一大拖累。其次，你确定在校外的大好时光不用来和妹子吃饭聊天玩耍？**你们为啥不去电影院？？**

Well, Well, All right，我们假设你**不仅要和妹子一起看电影**，**还要顺便秀自己这套系统**……这时候 Frp 内网穿透就派上用场了。Frp 是通过第三方服务器转发流量的服务。你需要购买自己的服务器。然后在内网装 Frp 发送端，外网部署 Frp 转发。

关于怎么配置 Frp，可以自行研究，OpenWrt 依然提供了简单的辅助设置页面。我还是推荐各位去电影院，否则你可能会**赢了面子，输了人生。**

## 瞎捣鼓：后面还有什么

有了路由器，感觉人生都变得明亮了一点(?)。后续这个博客会逐渐更新怎样使用路由器，使得外网（比如手机 4G，或者在家里云打印）也可以使用学校的联创打印系统，也可以访问学校的 OJ 系统，也可以访问物理开放实验系统。

还有一篇，会简单介绍用磁盘的另一个分区搭建自动 Time Machine 备份。回到宿舍，你的 mac 就能自动备份，过程是完全无痛的。
